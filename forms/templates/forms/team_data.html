<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Data - Deye</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 5px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .view-mode-badge {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-left: 15px;
        }
        
        .view-mode-badge.superuser {
            background: #f59e0b;
        }

        .back-btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .count-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .no-data {
            color: #999;
            font-style: italic;
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
            border-radius: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }

        tbody tr {
            transition: all 0.2s;
        }

        tbody tr:hover {
            background: #f8f9fa;
            transform: scale(1.01);
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .status-dispatched {
            background: #d1ecf1;
            color: #0c5460;
        }

        .scrollable {
            overflow-x: auto;
        }

        .filters-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .filters-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .filter-btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .clear-btn {
            padding: 10px 25px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .clear-btn:hover {
            background: #5a6268;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .export-btn {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .export-btn:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .export-btn.xlsx {
            background: #17a2b8;
        }

        .export-btn.xlsx:hover {
            background: #138496;
            box-shadow: 0 5px 15px rgba(23, 162, 184, 0.4);
        }

        .tab-export {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .tab-export .export-btn {
            padding: 8px 16px;
            font-size: 14px;
        }

        .tab-filters {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .tab-filters-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .tab-filter-group {
            flex: 1;
            min-width: 150px;
        }

        .tab-filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 12px;
        }

        .tab-filter-group input,
        .tab-filter-group select {
            width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
        }

        .tab-filter-btn {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
        }

        .tab-filter-btn:hover {
            background: #764ba2;
        }

        .tab-clear-btn {
            padding: 8px 16px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
            text-decoration: none;
            display: inline-block;
        }

        .tab-clear-btn:hover {
            background: #5a6268;
        }

        .duplicate-badge {
            background: #ff6b6b;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 5px;
            display: inline-block;
        }
        
        tr.duplicate-row {
            background: #fff3cd !important;
            border-left: 4px solid #ffc107;
        }
        
        tr.duplicate-row:hover {
            background: #ffe69c !important;
        }

        .edit-btn {
            padding: 6px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .edit-btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }

        .duplicate-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .duplicate-info h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .duplicate-item {
            padding: 8px;
            background: white;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .duplicate-serial {
            font-weight: 600;
            color: #333;
        }

        .duplicate-count {
            background: #ff6b6b;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn:hover, .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 24px;
            }

            .section {
                padding: 20px;
            }

            th, td {
                padding: 10px;
                font-size: 14px;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: none;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 22px;
            margin: 0;
        }

        .close {
            color: #aaa;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
            line-height: 1;
        }

        .close:hover,
        .close:focus {
            color: #667eea;
        }

        .modal-body {
            color: #333;
            font-size: 16px;
            line-height: 1.8;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .clickable-cell {
            cursor: pointer;
            position: relative;
        }

        .clickable-cell:hover {
            background-color: #f0f0ff !important;
            text-decoration: underline;
        }

        .clickable-cell::after {
            content: "üîç";
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .clickable-cell:hover::after {
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Team Data</h1>
            <p>All form responses from your team members.</p>
        </div>

        <!-- Tabs for different form types -->
        <div class="section">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('repairing')">Repairing Forms</button>
                <button class="tab-btn" onclick="switchTab('inward')">Inward Forms</button>
                <button class="tab-btn" onclick="switchTab('outward')">Outward Forms</button>
                <button class="tab-btn" onclick="switchTab('service')">Service Reports</button>
                <button class="tab-btn" onclick="switchTab('stock-req')">Stock Requisitions</button>
                <button class="tab-btn" onclick="switchTab('stock-disp')">Stock Dispatched</button>
                <button class="tab-btn" onclick="switchTab('stock-inv')">Stock Inverters</button>
            </div>

            <!-- Repairing Forms Tab -->
            <div id="repairing" class="tab-content active">
                <h2 class="section-title">
                    üîß Repairing Forms
                    <span class="count-badge">{{ repairing_forms.count }}</span>
                </h2>
                
                <!-- Filters for Repairing -->
                <div class="tab-filters">
                    <form method="GET" id="repairing-filter-form">
                        <input type="hidden" name="tab" value="repairing">
                        <div class="tab-filters-row">
                            <div class="tab-filter-group">
                                <label>From Date</label>
                                <input type="date" name="repairing_date_from" value="{{ repairing_date_from }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>To Date</label>
                                <input type="date" name="repairing_date_to" value="{{ repairing_date_to }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>Search</label>
                                <input type="text" name="repairing_search" placeholder="Case, Customer, Inverter..." value="{{ repairing_search }}">
                            </div>
                            <div class="tab-filter-group">
                                <button type="submit" class="tab-filter-btn">Filter</button>
                            </div>
                            <div class="tab-filter-group">
                                <a href="?tab=repairing" class="tab-clear-btn">Clear</a>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="tab-export">
                    <a href="{% url 'forms:export_team_data' 'repairing' 'csv' %}?repairing_date_from={{ repairing_date_from }}&repairing_date_to={{ repairing_date_to }}&repairing_search={{ repairing_search }}" class="export-btn">
                        üìÑ Export CSV
                    </a>
                    <a href="{% url 'forms:export_team_data' 'repairing' 'xlsx' %}?repairing_date_from={{ repairing_date_from }}&repairing_date_to={{ repairing_date_to }}&repairing_search={{ repairing_search }}" class="export-btn xlsx">
                        üìä Export Excel
                    </a>
                </div>
                {% if repairing_forms %}
                <div class="scrollable">
                    <table>
                        <thead>
                            <tr>
                                <th>Repaired On</th>
                                <th>Customer Abbreviation</th>
                                <th>Repairing Object</th>
                                <th>Inverter ID</th>
                                <th>Battery ID</th>
                                <th>PCB Serial Number</th>
                                <th>Inverter Specifications</th>
                                <th>Inverter Ratings</th>
                                <th>PCB Specification</th>
                                <th>PCB Rating</th>
                                <th>Battery Model</th>
                                <th>Fault Problems</th>
                                <th>Fault Description</th>
                                <th>Fault Location</th>
                                <th>Repair Content</th>
                                <th>Repaired By</th>
                                <th>Tested By</th>
                                <th>Filled By</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for form in repairing_forms %}
                            <tr{% if form.duplicate_count %} class="duplicate-row"{% endif %}>
                                <td>{{ form.repaired_on_date|date:"d M Y" }}</td>
                                <td>{{ form.customer_abbrev }}</td>
                                <td>{{ form.repairing_object }}</td>
                                <td>{{ form.inverter_id }}</td>
                                <td>{{ form.battery_id }}</td>
                                <td>{{ form.pcb_serial_number }}</td>
                                <td>{{ form.inverter_spec }}</td>
                                <td>{{ form.inverter_rating }}</td>
                                <td>{{ form.pcb_specification }}</td>
                                <td>{{ form.pcb_rating }}</td>
                                <td>{{ form.battery }}</td>
                                <td>{{ form.fault_problems }}</td>
                                <td>{{ form.fault_description }}</td>
                                <td>{{ form.fault_location }}</td>
                                <td>{{ form.repair_content }}</td>
                                <td>{{ form.repaired_by }}</td>
                                <td>{{ form.tested_by }}</td>
                                <td>{% if form.user %}{{ form.user.get_full_name|default:form.user.username }}{% else %}-{% endif %}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="no-data">No repairing forms submitted yet.</div>
                {% endif %}
            </div>

            <!-- Inward Forms Tab -->
            <div id="inward" class="tab-content">
                <h2 class="section-title">
                    üì• Inward Forms
                    <span class="count-badge">{{ inward_forms.count }}</span>
                </h2>
                
                <!-- Filters for Inward -->
                <div class="tab-filters">
                    <form method="GET" id="inward-filter-form">
                        <input type="hidden" name="tab" value="inward">
                        <div class="tab-filters-row">
                            <div class="tab-filter-group">
                                <label>From Date</label>
                                <input type="date" name="inward_date_from" value="{{ inward_date_from }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>To Date</label>
                                <input type="date" name="inward_date_to" value="{{ inward_date_to }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>Search</label>
                                <input type="text" name="inward_search" placeholder="Customer, Inverter, AWB..." value="{{ inward_search }}">
                            </div>
                            <div class="tab-filter-group">
                                <button type="submit" class="tab-filter-btn">Filter</button>
                            </div>
                            <div class="tab-filter-group">
                                <a href="?tab=inward" class="tab-clear-btn">Clear</a>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="tab-export">
                    <a href="{% url 'forms:export_team_data' 'inward' 'csv' %}?inward_date_from={{ inward_date_from }}&inward_date_to={{ inward_date_to }}&inward_search={{ inward_search }}" class="export-btn">
                        üìÑ Export CSV
                    </a>
                    <a href="{% url 'forms:export_team_data' 'inward' 'xlsx' %}?inward_date_from={{ inward_date_from }}&inward_date_to={{ inward_date_to }}&inward_search={{ inward_search }}" class="export-btn xlsx">
                        üìä Export Excel
                    </a>
                </div>
                {% if inward_forms %}
                <div class="scrollable">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Inward Object</th>
                                <th>Customer Abbreviation</th>
                                <th>Customer Name</th>
                                <th>Inverter ID</th>
                                <th>Battery ID</th>
                                <th>PCB Serial Number</th>
                                <th>Inverter Specification</th>
                                <th>Inverter Ratings</th>
                                <th>Battery Model</th>
                                <th>No of MPPT</th>
                                <th>Current/MPPT</th>
                                <th>PCB Quantity</th>
                                <th>Received From Location</th>
                                <th>Received From District</th>
                                <th>Received From State</th>
                                <th>Pincode</th>
                                <th>Received By</th>
                                <th>Reason</th>
                                <th>Transportation Mode</th>
                                <th>AWB Number</th>
                                <th>Filled By</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for form in inward_forms %}
                            <tr{% if form.duplicate_count %} class="duplicate-row"{% endif %}>
                                <td>{{ form.created_at|date:"d M Y" }}</td>
                                <td>{{ form.inward_object }}</td>
                                <td>{{ form.customer_abbrev }}</td>
                                <td>{{ form.customer_name }}</td>
                                <td>{{ form.inverter_id }}</td>
                                <td>{{ form.battery_id }}</td>
                                <td>{{ form.pcb_serial_number }}</td>
                                <td>{{ form.inverter_specs }}</td>
                                <td>{{ form.inverter_ratings }}</td>
                                <td>{{ form.battery }}</td>
                                <td>{{ form.no_of_mppt }}</td>
                                <td>{{ form.current_mppt }}</td>
                                <td>{{ form.pcb_quantity }}</td>
                                <td>{{ form.received_from_location }}</td>
                                <td>{{ form.received_from_district }}</td>
                                <td>{{ form.received_from_state }}</td>
                                <td>{{ form.pincode }}</td>
                                <td>{{ form.received_by }}</td>
                                <td>{{ form.reason }}</td>
                                <td>{{ form.transportation_mode }}</td>
                                <td>{{ form.awb_lr_number }}</td>
                                <td>{% if form.user %}{{ form.user.get_full_name|default:form.user.username }}{% else %}-{% endif %}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="no-data">No inward forms submitted yet.</div>
                {% endif %}
            </div>

            <!-- Outward Forms Tab -->
            <div id="outward" class="tab-content">
                <h2 class="section-title">
                    üì§ Outward Forms
                    <span class="count-badge">{{ outward_forms.count }}</span>
                </h2>
                
                <!-- Filters for Outward -->
                <div class="tab-filters">
                    <form method="GET" id="outward-filter-form">
                        <input type="hidden" name="tab" value="outward">
                        <div class="tab-filters-row">
                            <div class="tab-filter-group">
                                <label>From Date</label>
                                <input type="date" name="outward_date_from" value="{{ outward_date_from }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>To Date</label>
                                <input type="date" name="outward_date_to" value="{{ outward_date_to }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>Search</label>
                                <input type="text" name="outward_search" placeholder="Inverter, Company, AWB..." value="{{ outward_search }}">
                            </div>
                            <div class="tab-filter-group">
                                <button type="submit" class="tab-filter-btn">Filter</button>
                            </div>
                            <div class="tab-filter-group">
                                <a href="?tab=outward" class="tab-clear-btn">Clear</a>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="tab-export">
                    <a href="{% url 'forms:export_team_data' 'outward' 'csv' %}?outward_date_from={{ outward_date_from }}&outward_date_to={{ outward_date_to }}&outward_search={{ outward_search }}" class="export-btn">
                        üìÑ Export CSV
                    </a>
                    <a href="{% url 'forms:export_team_data' 'outward' 'xlsx' %}?outward_date_from={{ outward_date_from }}&outward_date_to={{ outward_date_to }}&outward_search={{ outward_search }}" class="export-btn xlsx">
                        üìä Export Excel
                    </a>
                </div>
                {% if outward_forms %}
                <div class="scrollable">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Outward Object</th>
                                <th>Inverter ID (Outward)</th>
                                <th>Inverter Spec</th>
                                <th>Inverter Rating</th>
                                <th>Battery</th>
                                <th>Battery ID</th>
                                <th>Sent To Company</th>
                                <th>Sent To Address</th>
                                <th>Sent To District</th>
                                <th>Sent To State</th>
                                <th>Pincode</th>
                                <th>Sent By</th>
                                <th>Approved By</th>
                                <th>Control Card Changed</th>
                                <th>New Serial Number</th>
                                <th>Inverter ID (Inward)</th>
                                <th>Inverter Replaced</th>
                                <th>Delivered Through</th>
                                <th>AWB Number</th>
                                <th>Remarks</th>
                                <th>Filled By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for form in outward_forms %}
                            <tr{% if form.duplicate_count %} class="duplicate-row"{% endif %}>
                                <td>{{ form.created_at|date:"d M Y" }}</td>
                                <td>{{ form.outward_object }}</td>
                                <td>{{ form.inverter_id_outward }}</td>
                                <td>{{ form.inverter_spec }}</td>
                                <td>{{ form.inverter_rating }}</td>
                                <td>{{ form.battery }}</td>
                                <td>{{ form.battery_id }}</td>
                                <td>{{ form.sent_to_company }}</td>
                                <td>{{ form.sent_to_address }}</td>
                                <td>{{ form.sent_to_district }}</td>
                                <td>{{ form.sent_to_state }}</td>
                                <td>{{ form.pincode }}</td>
                                <td>{{ form.sent_by }}</td>
                                <td>{{ form.approved_by }}</td>
                                <td>{{ form.control_card_changed }}</td>
                                <td>{{ form.new_serial_number }}</td>
                                <td>{{ form.inverter_id_inward }}</td>
                                <td>{{ form.inverter_replaced }}</td>
                                <td>{{ form.delivered_through }}</td>
                                <td>{{ form.awb_number }}</td>
                                <td>{{ form.remarks }}</td>
                                <td></td>
                                <td>{% if form.user %}{{ form.user.get_full_name|default:form.user.username }}{% else %}-{% endif %}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="no-data">No outward forms submitted yet.</div>
                {% endif %}
            </div>

            <!-- Service Reports Tab -->
            <div id="service" class="tab-content">
                <h2 class="section-title">
                    üõ†Ô∏è Service Reports
                    <span class="count-badge">{{ service_forms.count }}</span>
                </h2>
                
                <!-- Filters for Service -->
                <div class="tab-filters">
                    <form method="GET" id="service-filter-form">
                        <input type="hidden" name="tab" value="service">
                        <div class="tab-filters-row">
                            <div class="tab-filter-group">
                                <label>From Date</label>
                                <input type="date" name="service_date_from" value="{{ service_date_from }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>To Date</label>
                                <input type="date" name="service_date_to" value="{{ service_date_to }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>Search</label>
                                <input type="text" name="service_search" placeholder="Serial, Customer..." value="{{ service_search }}">
                            </div>
                            <div class="tab-filter-group">
                                <button type="submit" class="tab-filter-btn">Filter</button>
                            </div>
                            <div class="tab-filter-group">
                                <a href="?tab=service" class="tab-clear-btn">Clear</a>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="tab-export">
                    <a href="{% url 'forms:export_team_data' 'service' 'csv' %}?service_date_from={{ service_date_from }}&service_date_to={{ service_date_to }}&service_search={{ service_search }}" class="export-btn">
                        üìÑ Export CSV
                    </a>
                    <a href="{% url 'forms:export_team_data' 'service' 'xlsx' %}?service_date_from={{ service_date_from }}&service_date_to={{ service_date_to }}&service_search={{ service_search }}" class="export-btn xlsx">
                        üìä Export Excel
                    </a>
                </div>
                {% if service_forms %}
                <div class="scrollable">
                    <table>
                        <thead>
                            <tr>
                                <th>Submission Date</th>
                                <th>Engineer</th>
                                <th>Customer</th>
                                <th>Product Type</th>
                                <th>Serial Number</th>
                                <th>Service Date</th>
                                <th>Inverter Capacity</th>
                                <th>PV Capacity (KW)</th>
                                <th>No of MPPT</th>
                                <th>DC Side PV Data</th>
                                <th>AC Side Data</th>
                                <th>Address</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>LCD Version</th>
                                <th>MCU Version</th>
                                <th>Battery Type</th>
                                <th>Battery Make</th>
                                <th>Battery Voltage</th>
                                <th>Protocol</th>
                                <th>Conclusion</th>
                                <th>Customer Ratings</th>
                                <th>Physical Observation</th>
                                <th>Actual Work Done</th>
                                <th>Cause of Failure</th>
                                <th>AC Cable Size</th>
                                <th>Filled By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for form in service_forms %}
                            <tr{% if form.duplicate_count %} class="duplicate-row"{% endif %}>
                                <td>{{ form.created_at|date:"d M Y" }}</td>
                                <td><strong>{{ form.engineer_first_name }} {{ form.engineer_last_name }}</strong></td>
                                <td>{{ form.customer_first_name }} {{ form.customer_last_name }}</td>
                                <td>{{ form.product_type }}</td>
                                <td>
                                    <code style="background: #f0f0f0; padding: 4px 6px; border-radius: 3px;">{{ form.serial_number }}</code>
                                    {% if form.duplicate_count %}
                                    <span class="duplicate-badge" title="This serial appears {{ form.duplicate_count }} times">√ó{{ form.duplicate_count }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ form.date_of_service|date:"d M Y"|default:"‚Äî" }}</td>
                                <td>{{ form.inverter_capacity }}</td>
                                <td>{{ form.pv_capacity_kw }} KW</td>
                                <td>{{ form.no_of_mppt }}</td>
                                <td class="clickable-cell" style="text-align: center;" onclick="showPVData({{ form.id }}, {{ form.pv_data|safe }})">
                                    {% if form.pv_data %}
                                    <span style="background: #4ade80; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; cursor: pointer;">üìä View PV Data</span>
                                    {% else %}
                                    <span style="color: #999;">‚Äî</span>
                                    {% endif %}
                                </td>
                                <td class="clickable-cell" style="text-align: center;" onclick="showACData({{ form.id }}, {{ form.ac_data|safe }})">
                                    {% if form.ac_data %}
                                    <span style="background: #3b82f6; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; cursor: pointer;">‚ö° View AC Data</span>
                                    {% else %}
                                    <span style="color: #999;">‚Äî</span>
                                    {% endif %}
                                </td>
                                <td class="clickable-cell" style="max-width: 120px; overflow: hidden; text-overflow: ellipsis;" title="{{ form.address_street }}, {{ form.address_city }}, {{ form.address_state }}" onclick="showFullContent('Full Address', '{{ form.address_street }}, {{ form.address_city }}, {{ form.address_state }}, {{ form.address_zip }}')">{{ form.address_city }}, {{ form.address_state }}</td>
                                <td>{{ form.phone_number }}</td>
                                <td>{{ form.email }}</td>
                                <td>{{ form.lcd_version }}</td>
                                <td>{{ form.mcu_version }}</td>
                                <td>{{ form.battery_type|default:"‚Äî" }}</td>
                                <td>{{ form.battery_make|default:"‚Äî" }}</td>
                                <td>{{ form.battery_voltage|default:"‚Äî" }}</td>
                                <td>{{ form.protocol }}</td>
                                <td class="clickable-cell" onclick="showFullContent('Conclusion', '{{ form.conclusion }}')">
                                    {% if "OK" in form.conclusion or "Working" in form.conclusion %}
                                    <span style="background: #10b981; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">‚úì {{ form.conclusion|truncatewords:2 }}</span>
                                    {% elif "Repair" in form.conclusion %}
                                    <span style="background: #f59e0b; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">‚ö† {{ form.conclusion|truncatewords:2 }}</span>
                                    {% else %}
                                    <span style="background: #ef4444; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">‚úó {{ form.conclusion|truncatewords:2 }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ form.customer_ratings|default:"‚Äî" }}</td>
                                <td class="clickable-cell" style="max-width: 120px; overflow: hidden; text-overflow: ellipsis;" title="{{ form.physical_observation }}" onclick="showFullContent('Physical Observation', '{{ form.physical_observation }}')">{{ form.physical_observation|truncatewords:3 }}</td>
                                <td class="clickable-cell" style="max-width: 120px; overflow: hidden; text-overflow: ellipsis;" title="{{ form.actual_work_done }}" onclick="showFullContent('Actual Work Done', '{{ form.actual_work_done }}')">{{ form.actual_work_done|truncatewords:3 }}</td>
                                <td class="clickable-cell" style="max-width: 120px; overflow: hidden; text-overflow: ellipsis;" title="{{ form.cause_of_failure }}" onclick="showFullContent('Cause of Failure', '{{ form.cause_of_failure }}')">{{ form.cause_of_failure|truncatewords:3 }}</td>
                                <td>{{ form.ac_cable_size|default:"‚Äî" }}</td>
                                <td>{% if form.user %}{{ form.user.get_full_name|default:form.user.username }}{% else %}-{% endif %}</td>
                                <td>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="no-data">No service reports submitted yet.</div>
                {% endif %}
            </div>

            <!-- Stock Requisitions Tab -->
            <div id="stock-req" class="tab-content">
                <h2 class="section-title">
                    üì¶ Stock Requisitions
                    <span class="count-badge">{{ stock_requisitions.count }}</span>
                </h2>
                
                <!-- Filters for Stock Requisitions -->
                <div class="tab-filters">
                    <form method="GET" id="stock-req-filter-form">
                        <input type="hidden" name="tab" value="stock-req">
                        <div class="tab-filters-row">
                            <div class="tab-filter-group">
                                <label>From Date</label>
                                <input type="date" name="stock_req_date_from" value="{{ stock_req_date_from }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>To Date</label>
                                <input type="date" name="stock_req_date_to" value="{{ stock_req_date_to }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>Search</label>
                                <input type="text" name="stock_req_search" placeholder="Serial, Component..." value="{{ stock_req_search }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>Status</label>
                                <select name="stock_req_status">
                                    <option value="">All</option>
                                    <option value="pending" {% if stock_req_status == 'pending' %}selected{% endif %}>Pending</option>
                                    <option value="approved" {% if stock_req_status == 'approved' %}selected{% endif %}>Approved</option>
                                    <option value="rejected" {% if stock_req_status == 'rejected' %}selected{% endif %}>Rejected</option>
                                    <option value="dispatched" {% if stock_req_status == 'dispatched' %}selected{% endif %}>Dispatched</option>
                                </select>
                            </div>
                            <div class="tab-filter-group">
                                <button type="submit" class="tab-filter-btn">Filter</button>
                            </div>
                            <div class="tab-filter-group">
                                <a href="?tab=stock-req" class="tab-clear-btn">Clear</a>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="tab-export">
                    <a href="{% url 'forms:export_team_data' 'stock-req' 'csv' %}?stock_req_date_from={{ stock_req_date_from }}&stock_req_date_to={{ stock_req_date_to }}&stock_req_search={{ stock_req_search }}&stock_req_status={{ stock_req_status }}" class="export-btn">
                        üìÑ Export CSV
                    </a>
                    <a href="{% url 'forms:export_team_data' 'stock-req' 'xlsx' %}?stock_req_date_from={{ stock_req_date_from }}&stock_req_date_to={{ stock_req_date_to }}&stock_req_search={{ stock_req_search }}&stock_req_status={{ stock_req_status }}" class="export-btn xlsx">
                        üìä Export Excel
                    </a>
                </div>
                {% if stock_requisitions %}
                <div class="scrollable">
                    <table>
                        <thead>
                            <tr>
                                <th>Serial Number</th>
                                <th>Component Type</th>
                                <th>Description</th>
                                <th>Qty Required</th>
                                <th>Qty Approved</th>
                                <th>Required To</th>
                                <th>Status</th>
                                <th>Manager Name</th>
                                <th>Approved By</th>
                                <th>Approval Date</th>
                                <th>Created</th>
                                <th>Filled By</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for req in stock_requisitions %}
                            <tr>
                                <td>{{ req.serial_number }}</td>
                                <td>{{ req.component_type }}</td>
                                <td>{{ req.description }}</td>
                                <td>{{ req.quantity_required }}</td>
                                <td>{{ req.approved_quantity|default:"‚Äî" }}</td>
                                <td>{{ req.required_to }}</td>
                                <td><span class="status-badge status-{{ req.status }}">{{ req.get_status_display }}</span></td>
                                <td>{{ req.manager_name }}</td>
                                <td>{{ req.approved_by }}</td>
                                <td>{{ req.approval_date|date:"d M Y" }}</td>
                                <td>{{ req.created_at|date:"d M Y" }}</td>
                                <td>{% if req.user %}{{ req.user.get_full_name|default:req.user.username }}{% else %}-{% endif %}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="no-data">No stock requisitions submitted yet.</div>
                {% endif %}
            </div>

            <!-- Stock Dispatched Tab -->
            <div id="stock-disp" class="tab-content">
                <h2 class="section-title">
                    üöö Stock Dispatched
                    <span class="count-badge">{{ dispatched_stock.count }}</span>
                </h2>
                
                <!-- Filters for Stock Dispatched -->
                <div class="tab-filters">
                    <form method="GET" id="stock-disp-filter-form">
                        <input type="hidden" name="tab" value="stock-disp">
                        <div class="tab-filters-row">
                            <div class="tab-filter-group">
                                <label>From Date</label>
                                <input type="date" name="stock_disp_date_from" value="{{ stock_disp_date_from }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>To Date</label>
                                <input type="date" name="stock_disp_date_to" value="{{ stock_disp_date_to }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>Search</label>
                                <input type="text" name="stock_disp_search" placeholder="Serial, Tracking..." value="{{ stock_disp_search }}">
                            </div>
                            <div class="tab-filter-group">
                                <button type="submit" class="tab-filter-btn">Filter</button>
                            </div>
                            <div class="tab-filter-group">
                                <a href="?tab=stock-disp" class="tab-clear-btn">Clear</a>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="tab-export">
                    <a href="{% url 'forms:export_team_data' 'stock-disp' 'csv' %}?stock_disp_date_from={{ stock_disp_date_from }}&stock_disp_date_to={{ stock_disp_date_to }}&stock_disp_search={{ stock_disp_search }}" class="export-btn">
                        üìÑ Export CSV
                    </a>
                    <a href="{% url 'forms:export_team_data' 'stock-disp' 'xlsx' %}?stock_disp_date_from={{ stock_disp_date_from }}&stock_disp_date_to={{ stock_disp_date_to }}&stock_disp_search={{ stock_disp_search }}" class="export-btn xlsx">
                        üìä Export Excel
                    </a>
                </div>
                {% if dispatched_stock %}
                <div class="scrollable">
                    <table>
                        <thead>
                            <tr>
                                <th>Serial Number</th>
                                <th>Component</th>
                                <th>Quantity Dispatched</th>
                                <th>Engineer Name</th>
                                <th>Dispatch Location</th>
                                <th>Dispatch Date</th>
                                <th>Courier Name</th>
                                <th>Tracking Number</th>
                                <th>Dispatch Remarks</th>
                                <th>Dispatched By</th>
                                <th>Created</th>
                                <th>Filled By</th>
                                <th>Updated</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stock in dispatched_stock %}
                            <tr>
                                <td>{{ stock.serial_number }}</td>
                                <td>{{ stock.component_type }}</td>
                                <td>{{ stock.quantity_dispatched }}</td>
                                <td>{{ stock.engineer_name }}</td>
                                <td>{{ stock.dispatch_location }}</td>
                                <td>{{ stock.dispatch_date|date:"d M Y" }}</td>
                                <td>{{ stock.courier_name }}</td>
                                <td>{{ stock.tracking_number }}</td>
                                <td>{{ stock.dispatch_remarks }}</td>
                                <td>{{ stock.dispatched_by }}</td>
                                <td>{{ stock.created_at|date:"d M Y" }}</td>
                                <td>{% if stock.user %}{{ stock.user.get_full_name|default:stock.user.username }}{% else %}-{% endif %}</td>
                                <td>{{ stock.updated_at|date:"d M Y" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="no-data">No stock dispatched yet.</div>
                {% endif %}
            </div>

            <!-- Stock Inverters Tab -->
            <div id="stock-inv" class="tab-content">
                <h2 class="section-title">
                    üè∑Ô∏è Stock Inverters
                    <span class="count-badge">{{ stock_inverters.count }}</span>
                </h2>
                <!-- Filters for Stock Inverters -->
                <div class="tab-filters">
                    <form method="GET" id="stock-inv-filter-form">
                        <input type="hidden" name="tab" value="stock-inv">
                        <div class="tab-filters-row">
                            <div class="tab-filter-group">
                                <label>From Date</label>
                                <input type="date" name="stock_inv_date_from" value="{{ stock_inv_date_from }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>To Date</label>
                                <input type="date" name="stock_inv_date_to" value="{{ stock_inv_date_to }}">
                            </div>
                            <div class="tab-filter-group">
                                <label>Search</label>
                                <input type="text" name="stock_inv_search" placeholder="Serial, Customer, Location..." value="{{ stock_inv_search }}">
                            </div>
                            <div class="tab-filter-group">
                                <button type="submit" class="tab-filter-btn">Filter</button>
                            </div>
                            <div class="tab-filter-group">
                                <a href="?tab=stock-inv" class="tab-clear-btn">Clear</a>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="tab-export">
                    <a href="#" class="export-btn">üìÑ Export CSV</a>
                    <a href="#" class="export-btn xlsx">üìä Export Excel</a>
                </div>
                {% if stock_inverters_display %}
                <div class="scrollable">
                    <table>
                        <thead>
                            <tr>
                                <th>Received Date</th>
                                <th>Inward Object</th>
                                <th>Serial Number</th>
                                <th>Battery ID</th>
                                <th>Customer Name</th>
                                <th>Customer Abbreviation</th>
                                <th>Received By</th>
                                <th>Received From Location</th>
                                <th>Received From District</th>
                                <th>Received From State</th>
                                <th>Pincode</th>
                                <th>Inverter Specification</th>
                                <th>Inverter Rating</th>
                                <th>Battery Model</th>
                                <th>Case Handled By</th>
                                <th>Transportation Mode</th>
                                <th>AWB Number</th>
                                <th>Filled By</th>
                                <th>Date Filled</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for invd in stock_inverters_display %}
                            <tr>
                                <td>{{ invd.form.created_at|date:'Y-m-d' }}</td>
                                <td>{{ invd.form.inward_object }}</td>
                                <td>{{ invd.form.inverter_id }}</td>
                                <td>{{ invd.form.battery_id }}</td>
                                <td>{{ invd.form.customer_name }}</td>
                                <td>{{ invd.form.customer_abbrev }}</td>
                                <td>{{ invd.form.received_by }}</td>
                                <td>{{ invd.form.received_from_location }}</td>
                                <td>{{ invd.form.received_from_district }}</td>
                                <td>{{ invd.form.received_from_state }}</td>
                                <td>{{ invd.form.pincode }}</td>
                                <td>{{ invd.form.inverter_specs }}</td>
                                <td>{{ invd.form.inverter_ratings }}</td>
                                <td>{{ invd.form.battery }}</td>
                                <td>{{ invd.form.case_handled_by }}</td>
                                <td>{{ invd.form.transportation_mode }}</td>
                                <td>{{ invd.form.awb_lr_number }}</td>
                                <td>{{ invd.filled_by }}</td>
                                <td>{{ invd.date_filled }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="no-data">No stock inverters found. All inverters have been sent out.</div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        function switchTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Deactivate all buttons
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Activate selected button
            event.target.classList.add('active');
        }

        // Check URL for tab parameter and switch to that tab
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const activeTab = urlParams.get('tab');
            
            if (activeTab) {
                // Find and activate the correct tab
                const tabs = document.querySelectorAll('.tab-content');
                const buttons = document.querySelectorAll('.tab-btn');
                
                tabs.forEach(tab => tab.classList.remove('active'));
                buttons.forEach(btn => btn.classList.remove('active'));
                
                const targetTab = document.getElementById(activeTab);
                if (targetTab) {
                    targetTab.classList.add('active');
                    // Find the corresponding button
                    buttons.forEach((btn, index) => {
                        if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(activeTab)) {
                            btn.classList.add('active');
                        }
                    });
                }
            }
        });

        // Modal functionality for viewing full content
        function showFullContent(title, content) {
            const modal = document.getElementById('contentModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = title;
            modalBody.textContent = content || 'No content available';
            modal.style.display = 'block';
        }

        function showPVData(formId, pvData) {
            const modal = document.getElementById('contentModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = 'üìä DC Side Measurements (PV Data)';
            
            if (!pvData || pvData.length === 0) {
                modalBody.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No PV data recorded</p>';
            } else {
                let html = '<table style="width: 100%; border-collapse: collapse; margin-top: 10px;">';
                html += '<thead style="background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); color: white;">';
                html += '<tr><th style="padding: 12px; border: 1px solid #ddd;">PV</th>';
                html += '<th style="padding: 12px; border: 1px solid #ddd;">Voltage (V)</th>';
                html += '<th style="padding: 12px; border: 1px solid #ddd;">Current (A)</th>';
                html += '<th style="padding: 12px; border: 1px solid #ddd;">Earthing</th>';
                html += '<th style="padding: 12px; border: 1px solid #ddd;">PV Panel</th>';
                html += '<th style="padding: 12px; border: 1px solid #ddd;">Observation</th></tr></thead>';
                html += '<tbody>';
                
                pvData.forEach((row, index) => {
                    if (row.voltage || row.current || row.earthing || row.panel || row.observation) {
                        html += `<tr style="background: ${index % 2 === 0 ? '#f9fafb' : 'white'};">`;
                        html += `<td style="padding: 10px; border: 1px solid #ddd; font-weight: 600;">PV ${index + 1}</td>`;
                        html += `<td style="padding: 10px; border: 1px solid #ddd;">${row.voltage || '‚Äî'}</td>`;
                        html += `<td style="padding: 10px; border: 1px solid #ddd;">${row.current || '‚Äî'}</td>`;
                        html += `<td style="padding: 10px; border: 1px solid #ddd;">${row.earthing || '‚Äî'}</td>`;
                        html += `<td style="padding: 10px; border: 1px solid #ddd;">${row.panel || '‚Äî'}</td>`;
                        html += `<td style="padding: 10px; border: 1px solid #ddd;">${row.observation || '‚Äî'}</td>`;
                        html += '</tr>';
                    }
                });
                
                html += '</tbody></table>';
                modalBody.innerHTML = html;
            }
            
            modal.style.display = 'block';
        }

        function showACData(formId, acData) {
            const modal = document.getElementById('contentModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = '‚ö° AC Side Measurements';
            
            if (!acData || Object.keys(acData).length === 0) {
                modalBody.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No AC data recorded</p>';
            } else {
                let html = '<table style="width: 100%; border-collapse: collapse; margin-top: 10px;">';
                html += '<thead style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">';
                html += '<tr><th style="padding: 12px; border: 1px solid #ddd;">Phase</th>';
                html += '<th style="padding: 12px; border: 1px solid #ddd;">Voltage (V)</th>';
                html += '<th style="padding: 12px; border: 1px solid #ddd;">Current (A)</th>';
                html += '<th style="padding: 12px; border: 1px solid #ddd;">Earthing</th></tr></thead>';
                html += '<tbody>';
                
                const phaseLabels = {
                    'R-N': 'R TO N', 'Y-N': 'Y TO N', 'B-N': 'B TO N',
                    'R-Y': 'R TO Y', 'Y-B': 'Y TO B', 'B-R': 'B TO R', 'N-PE': 'N TO PE'
                };
                
                let index = 0;
                for (const [phase, data] of Object.entries(acData)) {
                    if (data.voltage || data.current || data.earthing) {
                        html += `<tr style="background: ${index % 2 === 0 ? '#f9fafb' : 'white'};">`;
                        html += `<td style="padding: 10px; border: 1px solid #ddd; font-weight: 600;">${phaseLabels[phase] || phase}</td>`;
                        html += `<td style="padding: 10px; border: 1px solid #ddd;">${data.voltage || '‚Äî'}</td>`;
                        html += `<td style="padding: 10px; border: 1px solid #ddd;">${data.current || '‚Äî'}</td>`;
                        html += `<td style="padding: 10px; border: 1px solid #ddd;">${data.earthing || '‚Äî'}</td>`;
                        html += '</tr>';
                        index++;
                    }
                }
                
                html += '</tbody></table>';
                modalBody.innerHTML = html;
            }
            
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('contentModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('contentModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>

    <!-- Modal for displaying full content -->
    <div id="contentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Full Content</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>
</body>
</html>
